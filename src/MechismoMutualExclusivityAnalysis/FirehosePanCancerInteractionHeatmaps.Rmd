---
title: "Firehose PanCancer Interaction Heatmap"
author: "Joshua Burkhart"
date: "July 20, 2017"
output:
  pdf_document:
    latex_engine: xelatex
---

# libs
```{r}
library(magrittr)
library(plyr)
library(dplyr)
library(reshape2)
library(ggplot2)
library(ggdendro)
library(Heatplus)
library(gtable)
library(grid)
library(plotly)
library(pheatmap)

input_csvs <- list.files("/media/burkhart/Media/Software/Ogmios/results/heatmapData/",pattern = "*total_interactions_with_mutated_interfaces.csv",full.names = TRUE)

all_csvs <- lapply(input_csvs,read.csv,header=TRUE,sep=",")
for(csvIdx in 1:length(all_csvs)){
  all_csvs[[csvIdx]]$CancerType = sub(".*firehose_([A-Z]+).*","\\1",input_csvs[csvIdx])
}

sample_df <- do.call("rbind.fill",all_csvs)
processed_ppi_sample_df <- sample_df %>%
  dplyr::select(CancerType,Interaction,P.Value,FDR) %>%
  dplyr::mutate(N.Log10.FDR = -log10(FDR + 0.00001)) %>%
  dplyr::filter(FDR < 0.05) %>%
  dplyr::select(CancerType,Interaction,N.Log10.FDR)

processed_ppi_sample_df$Interaction <- sub("(.*)\t(.*)","\\1 \\2",as.character(processed_ppi_sample_df$Interaction))
ppi_dendro <- processed_ppi_sample_df %>%
  reshape(idvar = "CancerType", timevar = "Interaction", direction = "wide")

names(ppi_dendro) <- gsub("N.Log10.FDR.(.*)","\\1",names(ppi_dendro))

rownames(ppi_dendro) <- ppi_dendro[,1]
ppi_dendro <- ppi_dendro[,-1]
ppi_dendro[is.na(ppi_dendro)] <- 0

m <- data.matrix(ppi_dendro, rownames.force = TRUE)

img_height = 6
img_width = 24
svg(filename = "/home/burkhart/Software/Ogmios/results/heatmapData/FirehosePanCancerInteractionHeatmap.svg",width = img_width, height = img_height)
pheatmap::pheatmap(m,
                   color = c("white","grey","yellow","orange","red","darkred","purple"),
                   main = "Pan Cancer Interaction -log10(FDR) for Interactions with FDR < 0.05",
                   clustering_distance_cols = "euclidean",
                   clustering_distance_rows = "euclidean",
                   fontsize = 8,
                   clustering_method = "complete",
                   width = img_width,
                   height = img_height)
dev.off()
```
